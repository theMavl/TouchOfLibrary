{% extends "base_generic.html" %}
{% block content %}
    <head>
        <style>
            .redtext {
                color: tomato;
            }

            .greentext {
                color: palegreen;
            }

            .highlight {
                color: lightseagreen;
            }
        </style>
    </head>
    <div><h1>{{ document.title }}</h1>
        <h4>{{ document.type }}</h4>
        {% if perms.library.change_reservation %}
            <a href="{% url 'documentinstance-create' pk=document.pk %}">New copy</a> |
            <a href="{% url 'document-update' pk=document.pk %}">Edit</a> |
            <a href="{% url 'document-delete' pk=document.pk %}">Delete</a>
        {% endif %}</div>
    <br>
    <p><strong>Authors:</strong> <a href=""></a>

        {% for author in document.authors.all %}
            <a href="{{ author.get_absolute_url }}">{{ author.first_name }} {{ author.last_name }}</a>
            {% if not forloop.last %},{% else %}{% endif %}
        {% endfor %}</p>

    <p><strong>Description:</strong> {{ document.description }}
    <p><strong>Tags:</strong>
        {% for tag in document.tags.all %}
            {{ tag }}
            {% if not forloop.last %},{% else %}{% endif %}
        {% endfor %}
    <p><strong>Quantity: {{ document.quantity }}</strong>
        {% if user.is_authenticated %}
            {% if document.is_reference %}
                <p><b class="redtext">Reference documents cannot be checked out.</b></p>
            {% elif given_out %}
                <p><strong>You must return copy till {{ given_out.document_instance.due_back }}</strong></p>
            {% elif not not_a_patron %}
                <p><strong> You can order this {{ document.type }} for <b class="highlight">{{ max_days }} </b> days. If
                    you check it out today, you will have to return it till <b
                            class="highlight">{{ due_date }}</b></strong></p>
            {% endif %}
            {% if given_out %}
                <p><b>Given out to you</b></p>
            {% endif %}
        {% endif %}

    {% if not user.is_authenticated and copy_list %}
        <p>To check out that {{ document.type }} you need to login</p>
    {% elif not copy_list %}
        <p class="redtext">There are no copies in the library yet</p>
    {% endif %}

    {#Table starts:#}

    {% if copy_list and not document.is_reference %}
        <table border="1" align="left" width="80%">
            <caption>Copies of this {{ document.type }}</caption>
            <tr>
                <th> Title</th>
                <th> Location</th>
                <th> Status</th>
                <th> Additional</th>
                {% if perms.library.change_documentinstance %}
                    {% if copy.status != 'g' %}
                        <th>Actions</th>
                    {% endif %}
                {% endif %}
            </tr>

            {% for copy in copy_list %}
                <tr>
                    <th>{{ copy.document.title }}</th>
                    <th><strong>Level </strong> {{ copy.location.level }},
                        <strong>room </strong> {{ copy.location.room }}
                    </th>

                    {% if copy.status == 'a' %}
                        {% if user.is_authenticated %}
                            {% if not_a_patron %}
                                <th bgcolor="#90ee90" title="You have no patron status">
                                    In library
                                </th>
                            {% elif not can_reserve %}
                                <th bgcolor="#90ee90" title="You are over reservation limit">
                                    In library
                                </th>
                            {% elif reserved or given_out %}
                                <th bgcolor="#90ee90" title="You cannot book more than one copy">
                                    In library
                                </th>
                            {% elif not not_a_patron %}
                                <th bgcolor="#90ee90" title="Book this document now!">
                                    <a href="{% url 'reserve-document' copy_id=copy.id %}"> Available for booking</a>
                                </th>
                            {% endif %}
                        {% else %}
                            <th bgcolor="#90ee90">
                                In library
                            </th>
                        {% endif %}
                    {% elif copy.status == 'g' %}
                        <th bgcolor="#ff6347" title="Will be available on {{ copy.due_back }}">
                            Given out

                            {% if perms.library.change_reservation %} to
                                <a href="{% url 'patron-details' id=copy.holder.id %}">{{ copy.holder }}</a>.
                                <a href="{{ copy.form_return_request_mail }}">Request to return</a>
                            {% elif copy.id == given_out.document_instance.id %} to you
                                <p>Overdue: {{ copy.overdue_days }}</p>
                            {% endif %}
                        </th>
                    {% elif copy.status == 'r' %}
                        {% if user.is_authenticated and reserved and reserved.first.document_copy == copy %}
                            <th bgcolor="#ffa07a" title="Cancel booking">
                                <a href="{% url 'reserve-document' copy_id=copy.id %}"> Reserved on you
                                    till {{ reserved.first.due_date }}</a>
                            </th>
                        {% else %}
                            <th bgcolor="#ffa07a">
                                Reserved
                            </th>
                        {% endif %}
                    {% else %}
                        <th bgcolor="#fffff0">
                            Maintenance
                        </th>
                    {% endif %}
                    <th>
                        {% for a in additional %}
                            {% if forloop.counter == 1 %}
                                <div><strong>{{ a }}: </strong> {{ copy.additional_field1 }} </div>
                            {% elif forloop.counter == 2 %}
                                <div><strong>{{ a }}: </strong> {{ copy.additional_field2 }} </div>
                            {% elif forloop.counter == 3 %}
                                <div><strong>{{ a }}: </strong> {{ copy.additional_field3 }} </div>
                            {% elif forloop.counter == 4 %}
                                <div><strong>{{ a }}: </strong> {{ copy.additional_field4 }} </div>
                            {% elif forloop.counter == 5 %}
                                <div><strong>{{ a }}: </strong> {{ copy.additional_field5 }} </div>
                            {% endif %}
                        {% endfor %}
                    </th>
                    {% if perms.library.change_documentinstance %}
                        {% if copy.status != 'g' %}
                            <th>
                                <div><a href="{% url 'documentinstance-update' id=copy.id %}">Edit copy</a>
                                    <div><a href="{% url 'documentinstance-deleteconfirm' id=copy.id %}">Delete copy</a>
                                        {% else %}
                            <th>Given out documents can not be updated or deleted</th>
                        {% endif %}
                    {% endif %}
                </tr>
            {% endfor %}
        </table>

    {% endif %}


{% endblock %}
