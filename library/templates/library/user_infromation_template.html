<!DOCTYPE html>
<html lang="en">
<head>
</head>
<body>

<div>
    <p>Personal data</p>
    <table>
        <tr>
            <td><b>Patron ID: </b></td>
            <td>{{ patron_user.id }}</td>
        </tr>
        <tr>
            <td><b>Full name: </b></td>
            <td>{{ patron_user.first_name }} {{ patron_user.last_name }}</td>
        </tr>
        <tr>
            <td><b>Email:</b></td>
            <td>{{ patron_user.email }}</td>
        </tr>
        <tr>
            <td><b>Patron type: </b></td>
            <td>{{ patron_info.patron_type }}</td>
        </tr>
        <tr>
            <td><b>Address:</b></td>
            <td>{{ patron_info.address }}</td>
        </tr>
        <tr>
            <td><b>Telegram</b></td>
            <td>{{ patron_info.telegram }}</td>
        </tr>
        <tr>
            <td><b>Phone Number: </b></td>
            <td>{{ patron_info.phone_number }}</td>
        </tr>
    </table>
</div>
<hr>
{% if reservation_table %}
    <div>
        <table border="1" align="left" width="80%">
            <caption> Reserved documents:</caption>
            <tr>
                <th> Document</th>
                {% if perms.library.change_reservation and perms.library.change_giveout %}
                    <th> Actions</th> {% endif %}
            </tr>

            {% for reservation in reservation_table %}
                <tr>
                    <th>
                        <a href="{{ reservation.document.get_absolute_url }}">{{ reservation.document_copy.summary }}</a>
                    </th>
                    {% if perms.library.change_reservation and perms.library.change_giveout %}
                        {% if reservation.document_copy.status == 'r' %}
                            <th bgcolor="#98fb98" title="Give out the copy">
                                <a href="{% url 'giveout-confirmation' id=reservation.id %}"> Give out </a>
                            </th>
                        {% else %}
                            <th bgcolor="#f08080">
                                Out of stock
                            </th>
                        {% endif %}
                    {% endif %}
                </tr>
            {% endfor %}
        </table>
    </div>
{% else %}
    <div>No reserved documents</div>
{% endif %}
<hr>
{% if giveout_table %}
    <div>
        <table border="1" align="left" width="80%">
            <caption> Given out documents:</caption>
            <tr>
                <th> Timestamp</th>
                <th> Document</th>
                <th> Return date</th>
                <th> Overdue days</th>
                {% if perms.library.change_reservation %}
                    <th> Actions</th> {% endif %}
            </tr>

            {% for issuance in giveout_table %}
                <tr>
                    <th> {{ issuance.timestamp }}</th>
                    <th>
                        <a href="{{ issuance.document.get_absolute_url }}">{{ issuance.document_instance.summary }}</a>
                    </th>
                    {% if issuance.document_instance.is_overdue %}
                        <th bgcolor="#ff6347">{{ issuance.document_instance.due_back }}</th>
                        <th bgcolor="#ff6347">{{ issuance.document_instance.overdue_days }}</th>
                    {% else %}
                        <th>
                            {{ issuance.document_instance.due_back }}</th>
                    {% endif %}
                    {% if perms.library.change_reservation and perms.library.delete_giveout %}
                        <th>
                            <div><a href="{{ issuance.document_instance.form_return_request_mail }}">Request return</a>
                            </div>
                            <div><a href="{{ issuance.get_absolute_url }}">Accept return</a></div>
                        </th>
                    {% endif %}
                </tr>
            {% endfor %}
        </table>
    </div>
{% else %}
    <div>No issued documents</div>
{% endif %}
<hr>
{% if giveout_log_table %}
    <div>
        <table border="1" align="left" width="80%">
            <caption> History of give out</caption>
            <tr>
                <th> Date issued</th>
                <th> Due date</th>
                <th> Date returned</th>
                <th> Document</th>
            </tr>

            {% for issuance in giveout_log_table %}
                {% if issuance.is_overdue %}
                    <tr bgcolor="#ff6347">
                        {% else %}
                    <tr>
                {% endif %}
            <th>{{ issuance.timestamp_given_out.date }}</th>
            <th>{{ issuance.timestamp_due_back.date }}</th>
            <th>{{ issuance.timestamp_returned.date }}</th>
            <th>{{ issuance.document_instance_summary }}</th>
            </tr>
            {% endfor %}
        </table>
    </div>

{% else %}
    <div>No booking history</div>
{% endif %}
</body>
</html>